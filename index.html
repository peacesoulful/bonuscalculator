<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SGC CALCULATOR 99.97%</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="SGC CALC">
  <meta name="theme-color" content="#0f172a">

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
    }
    body {
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 20px;
      text-transform: uppercase;
    }
    .container {
      max-width: 520px;
      width: 100%;
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 16px;
      padding: 20px;
    }
    h1 {
      margin-top: 0;
      text-align: center;
    }
    label {
      font-size: 0.9rem;
    }
    input, select, textarea {
      width: 100%;
      background: #0f172a;
      border: 1px solid #1e293b;
      color: #e5e7eb;
      font-size: 1rem;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 10px;
      border-radius: 8px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border: 1px solid #cbd5e1;
    }
    button {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      background: linear-gradient(135deg, #f8fafc, #cbd5e1);
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: 0.25s;
    }
    button:hover {
      box-shadow: 0 0 16px #e2e8f0;
    }
    button:active {
      transform: scale(0.98);
    }
    .results {
      margin-top: 12px;
      padding: 10px;
      background: #0f172a;
      border-radius: 12px;
      border: 1px solid #1e293b;
      font-size: 0.9rem;
    }
    .section-title {
      margin-top: 10px;
      margin-bottom: 5px;
      font-size: 0.85rem;
      color: #9ca3af;
      font-weight: bold;
    }
    .ok {
      color: #22c55e;
      font-weight: bold;
    }
    .footer {
      margin-top: 18px;
      text-align: center;
      font-size: 0.75rem;
      color: #6b7280;
    }

    /* LANGUAGE */
    .lang-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-bottom: 8px;
      gap: 6px;
    }
    .lang-select {
      width: auto;
      padding: 6px 8px;
      font-size: 0.75rem;
    }

    /* SGC PANELS */
    .top-panels {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    .panel {
      flex: 1 1 240px;
    }

    .clear-btn {
      width: auto;
      padding: 6px 12px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid #4b5563;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
    }
    .clear-btn:hover {
      background: #020617;
    }

    /* CALENDAR */
    .calendar-container {
      margin-top: 12px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .calendar-month {
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.05em;
    }
    .calendar-nav-btn {
      width: auto;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      color: #111827;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
    }
    .calendar-nav-btn:hover {
      background: #f9fafb;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px 6px;
      font-size: 0.75rem;
    }
    .calendar-day-header-row {
      display: contents;
    }
    .calendar-day-header {
      text-align: center;
      padding: 4px 0;
      color: #9ca3af;
      font-weight: 500;
    }
    .calendar-cell {
      min-height: 64px;
      border-radius: 12px;
      padding: 4px 4px;
      cursor: pointer;
      border: none;
      background: #020617;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.6);
    }
    .calendar-cell.selected {
      box-shadow: 0 0 0 2px #fbbf24;
    }
    .calendar-day-number {
      font-size: 0.75rem;
      margin-bottom: 2px;
      color: #e5e7eb;
      width: 100%;
      text-align: left;
      padding-left: 4px;
      font-weight: 500;
    }
    .calendar-shift-tag {
      margin-top: 2px;
      border-radius: 6px;
      padding: 2px 6px;
      border: none;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      text-transform: none;
      color: inherit;
      width: 100%;
      box-sizing: border-box;
      white-space: normal;
      overflow: visible;
      text-overflow: clip;
      box-shadow: none;
    }
    .shift-tag-label {
      font-size: 0.7rem;
      line-height: 1.1;
      text-align: left;
      width: 100%;
      letter-spacing: 0.02em;
      font-weight: 600;
    }
    .shift-tag-time {
      font-size: 0.6rem;
      line-height: 1.1;
      text-align: left;
      width: 100%;
      margin-top: 0px;
      opacity: 0.85;
    }
e-between;
      align-items: center;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .settings-toggle-btn {
      width: auto;
      padding: 6px 10px;
      font-size: 0.75rem;
      border-radius: 999px;
    }

    #settingsPanel {
      border-top: 1px solid #1f2933;
      padding-top: 8px;
      margin-top: 4px;
    }
    .shift-inline-row {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }
    .shift-inline-row > div {
      flex: 1;
    }
    .shift-actions-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .pill-btn {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      font-size: 0.8rem;
    }
    .pill-btn-secondary {
      background: #111827;
      border: 1px solid #374151;
    }

    .presets-container {
      margin-top: 10px;
    }
    .preset-row {
      display: grid;
      grid-template-columns: 1.4fr 1fr 1fr 0.7fr;
      gap: 6px;
      align-items: center;
      margin-bottom: 6px;
    }
    .preset-row input[type="time"] {
      padding: 6px;
      font-size: 0.8rem;
    }
    .preset-row input[type="text"] {
      padding: 6px;
      font-size: 0.8rem;
    }
    .preset-row input[type="color"] {
      padding: 0;
      height: 30px;
    }
    .preset-label {
      font-size: 0.75rem;
      color: #6b7280;
    }

    /* QUICK PICKER – CARD ESTILO SUPER SHIFT, POSICIONADO PERTO DO DIA */
    .quick-picker {
      position: fixed;
      inset: 0;
      display: none;
      background: transparent;
      z-index: 999;
    }
    .quick-picker-inner {
      position: absolute;
      width: 90%;
      max-width: 420px;
      background: #f9fafb;
      color: #111827;
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      padding: 10px 14px 12px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.45);
    }
    .quick-picker-title {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .quick-picker-buttons {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }
    .quick-picker-btn {
      width: 100%;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f3f4f6;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .quick-picker-btn:hover {
      background: #e5e7eb;
    }
    .qp-main {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .qp-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #111827;
    }
    .qp-time {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 1px;
    }
    .qp-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #f9fafb;
    }
    .quick-picker-btn-off .qp-dot {
      background: #6b7280;
    }
    .quick-picker-btn-danger {
      justify-content: center;
      background: #fee2e2;
      border-color: #fecaca;
    }
    .quick-picker-btn-danger .qp-label {
      text-align: center;
      color: #7f1d1d;
    }
    .quick-picker-cancel {
      margin-top: 8px;
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      color: #111827;
      box-shadow: 0 4px 15px rgba(15,23,42,0.25);
    }
    .quick-picker-cancel:hover {
      background: #f3f4f6;
    }
  
/* --- FIX: mostrar labels completos, estilo SuperShift --- */
.calendar-cell {
  overflow: visible !important;
}

.calendar-shift-tag {
  display: flex !important;
  flex-direction: column !important;
  align-items: flex-start !important;
  justify-content: center !important;
  width: 100% !important;
  border-radius: 6px !important;
  padding: 2px 8px !important;
  box-sizing: border-box !important;

  white-space: normal !important;
  overflow: visible !important;
  text-overflow: clip !important;
}

.shift-tag-label {
  font-size: 0.70rem !important;
  font-weight: 600 !important;
  text-align: left !important;
}

.shift-tag-time {
  font-size: 0.60rem !important;
  text-align: left !important;
  margin-top: 0 !important;
  opacity: 0.85 !important;
}
/* --- FIM DO FIX --- */
</style>
</head>
<body>
<div class="container">

  <!-- LANGUAGE -->
  <div class="lang-row">
    <span class="mini-label" id="langLabel">LANG</span>
    <select id="langSelect" class="lang-select">
      <option value="en">EN</option>
      <option value="pt">PT</option>
      <option value="es">ES</option>
    </select>
  </div>

  <h1 id="appTitle">SGC CALCULATOR</h1>
  <p id="targetLine">TARGET: <strong>99.97%</strong></p>

  <!-- CALENDÁRIO PRIMEIRO -->
  <div>
    <div class="section-title" id="sec3Title">3) SHIFT CALENDAR (INDEPENDENT)</div>

    <div class="calendar-container">
      <div class="calendar-header">
        <button class="calendar-nav-btn" id="prevMonthBtn">&lt;</button>
        <div class="calendar-month" id="calendarMonthLabel"></div>
        <button class="calendar-nav-btn" id="nextMonthBtn">&gt;</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <!-- QUICK PICKER -->
    <div id="quickPicker" class="quick-picker">
      <div class="quick-picker-inner">
        <div class="quick-picker-title" id="quickPickerTitle">CHOOSE SHIFT</div>
        <div class="quick-picker-buttons" id="quickPickerButtons"></div>
        <button id="quickPickerCancel" class="quick-picker-cancel">CANCEL</button>
      </div>
    </div>

    <!-- SETTINGS BAR -->
    <div class="settings-bar">
      <button class="settings-toggle-btn" id="toggleSettingsBtn">⚙ SETTINGS</button>
      <span class="selected-date-display" id="selectedDateDisplay">SELECT A DAY IN THE CALENDAR</span>
    </div>
    <div class="selected-note-display" id="selectedNoteDisplay"></div>

    <!-- SETTINGS PANEL -->
    <div id="settingsPanel">
      <div class="shift-inline-row">
        <div>
          <div class="mini-label" id="shiftTypeLabel">SHIFT</div>
          <select id="shiftTypeSelect"></select>
        </div>
      </div>

      <div class="shift-inline-row" id="customTimeRow" style="display:none;">
        <div>
          <div class="mini-label" id="startLabel">START</div>
          <input type="time" id="customStart">
        </div>
        <div>
          <div class="mini-label" id="endLabel">END</div>
          <input type="time" id="customEnd">
        </div>
      </div>

      <div style="margin-top:6px;">
        <div class="mini-label" id="noteLabel">NOTE</div>
        <textarea id="shiftNote" rows="2"></textarea>
      </div>

      <div class="shift-actions-row">
        <button id="saveShiftBtn" class="pill-btn">SAVE</button>
        <button id="clearDayBtn" class="pill-btn pill-btn-secondary">CLEAR DAY</button>
      </div>

      <div class="presets-container">
        <div class="mini-label" id="presetsTitle">SHIFT PRESETS</div>
        <div id="presetsForm"></div>
        <div class="shift-actions-row">
          <button id="savePresetsBtn" class="pill-btn">SAVE PRESETS</button>
          <button id="clearAllBtn" class="pill-btn pill-btn-secondary">CLEAR ALL</button>
        </div>
      </div>
    </div>
  </div>

  <hr style="margin:22px 0;border-top:1px solid #1e293b;">

  <!-- SGC CALCULATOR -->
  <div class="top-panels">
    <div class="panel">
      <div class="section-title" id="sec1Title">1) HOW MANY MISTAKES CAN I HAVE?</div>
      <label for="gamesInput" id="totalGamesLabel">TOTAL GAMES:</label>
      <input type="number" id="gamesInput">
      <button id="btnByGames">CALCULATE ALLOWED MISTAKES</button>
      <button class="clear-btn" id="clearGamesBtn">CLEAR</button>
      <div class="results" id="resultByGames" style="display:none;"></div>
    </div>

    <div class="panel">
      <div class="section-title" id="sec2Title">2) HOW MANY GAMES DO I NEED WITH THIS MANY MISTAKES?</div>
      <label for="errorsInput" id="mistakesLabel">MISTAKES:</label>
      <input type="number" id="errorsInput">
      <button id="btnByErrors">CALCULATE GAMES NEEDED</button>
      <button class="clear-btn" id="clearErrorsBtn">CLEAR</button>
      <div class="results" id="resultByErrors" style="display:none;"></div>
    </div>
  </div>

  <p class="footer" id="footerText">MADE FOR YOU ❤️</p>
</div>

<script>
  var TARGET = 99.97;
  var RATE = 0.0003;

  var gamesInput = document.getElementById("gamesInput");
  var btnByGames = document.getElementById("btnByGames");
  var resultByGames = document.getElementById("resultByGames");

  var errorsInput = document.getElementById("errorsInput");
  var btnByErrors = document.getElementById("btnByErrors");
  var resultByErrors = document.getElementById("resultByErrors");

  var clearGamesBtn = document.getElementById("clearGamesBtn");
  var clearErrorsBtn = document.getElementById("clearErrorsBtn");

  var langSelect = document.getElementById("langSelect");

  var quickPicker = document.getElementById("quickPicker");
  var quickPickerTitle = document.getElementById("quickPickerTitle");
  var quickPickerButtons = document.getElementById("quickPickerButtons");
  var quickPickerCancel = document.getElementById("quickPickerCancel");
  var quickPickerInner = document.querySelector(".quick-picker-inner");

  var calendarMonthLabel = document.getElementById("calendarMonthLabel");
  var calendarGrid = document.getElementById("calendarGrid");
  var prevMonthBtn = document.getElementById("prevMonthBtn");
  var nextMonthBtn = document.getElementById("nextMonthBtn");

  var shiftTypeSelect = document.getElementById("shiftTypeSelect");
  var customTimeRow = document.getElementById("customTimeRow");
  var customStartInput = document.getElementById("customStart");
  var customEndInput = document.getElementById("customEnd");
  var shiftNoteInput = document.getElementById("shiftNote");
  var saveShiftBtn = document.getElementById("saveShiftBtn");
  var clearDayBtn = document.getElementById("clearDayBtn");
  var selectedDateDisplay = document.getElementById("selectedDateDisplay");
  var selectedNoteDisplay = document.getElementById("selectedNoteDisplay");

  var presetsForm = document.getElementById("presetsForm");
  var savePresetsBtn = document.getElementById("savePresetsBtn");
  var clearAllBtn = document.getElementById("clearAllBtn");

  var settingsPanel = document.getElementById("settingsPanel");
  var toggleSettingsBtn = document.getElementById("toggleSettingsBtn");
  var settingsVisible = false;

  var SHIFT_STORAGE_KEY = "bonuscalendar_shifts_v1";
  var PRESET_STORAGE_KEY = "bonuscalendar_presets_v1";

  var currentYear;
  var currentMonth;
  var selectedDateISO = null;

  var i18n = {
    en: {
      appTitle: "SGC CALCULATOR",
      targetLine: "TARGET: <strong>99.97%</strong>",
      langLabel: "LANG",
      sec1Title: "1) HOW MANY MISTAKES CAN I HAVE?",
      sec2Title: "2) HOW MANY GAMES DO I NEED WITH THIS MANY MISTAKES?",
      sec3Title: "3) SHIFT CALENDAR (INDEPENDENT)",
      totalGamesLabel: "TOTAL GAMES:",
      mistakesLabel: "MISTAKES:",
      btnByGames: "CALCULATE ALLOWED MISTAKES",
      btnByErrors: "CALCULATE GAMES NEEDED",
      shiftTypeLabel: "SHIFT",
      startLabel: "START",
      endLabel: "END",
      noteLabel: "NOTE",
      saveShiftBtn: "SAVE",
      clearDayBtn: "CLEAR DAY",
      presetsTitle: "SHIFT PRESETS",
      savePresetsBtn: "SAVE PRESETS",
      clearAllShifts: "CLEAR ALL",
      footerText: "MADE FOR YOU ❤️",
      selectDayDefault: "SELECT A DAY IN THE CALENDAR",
      selectDayWithNoShift: function(iso){ return "DAY: " + iso + " (NO SHIFT)"; },
      selectedDayWithShift: function(iso,label,time){
        var t = "DAY: " + iso + " - " + label;
        if (time) t += " (" + time + ")";
        return t;
      },
      notePrefix: "NOTE:",
      dayHeaders: ["M","T","W","T","F","S","S"],
      monthLocale: "en-GB",
      errGames: "ENTER A VALID NUMBER OF GAMES.",
      errMistakes: "ENTER A VALID NUMBER OF MISTAKES.",
      errSelectDay: "PLEASE TAP A DAY IN THE CALENDAR FIRST.",
      errPresetSaved: "PRESETS SAVED.",
      hideSettings: "⚙ HIDE SETTINGS",
      showSettings: "⚙ SETTINGS",
      clearGames: "CLEAR",
      clearErrors: "CLEAR",
      quickTitle: "CHOOSE SHIFT FOR %DATE%",
      quickCancel: "CANCEL",
      quickOff: "OFF",
      quickClearDay: "CLEAR THIS DAY",
      confirmClearAll: "This will remove ALL shifts. Are you sure?",
      resultGamesHtml: function(games, maxErrors, sgc){
        return "<p>GAMES: <strong>" + games + "</strong></p>"
          + "<p>MAX MISTAKES TO KEEP ~" + TARGET + "%: <strong>" + maxErrors + "</strong></p>"
          + "<p>ESTIMATED SGC WITH THAT MANY MISTAKES: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSION: WITH " + games + " GAMES, YOU SHOULD NOT PASS " + maxErrors + " MISTAKES.</p>";
      },
      resultErrorsZeroHtml: function(){
        return "<p>MISTAKES: <strong>0</strong></p>"
          + "<p>YOU CAN PLAY ANY NUMBER OF GAMES AND YOUR SGC IS 100%.</p>";
      },
      resultErrorsHtml: function(errors, minGames, sgc){
        return "<p>MISTAKES: <strong>" + errors + "</strong></p>"
          + "<p>MINIMUM GAMES TO KEEP ~" + TARGET + "%: <strong>" + minGames + "</strong></p>"
          + "<p>SGC WITH " + errors + " MISTAKES IN " + minGames + " GAMES: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSION: WITH " + errors + " MISTAKES, YOU SHOULD PLAY AT LEAST " + minGames + " GAMES.</p>";
      }
    },
    pt: {
      appTitle: "CALCULADORA SGC",
      targetLine: "ALVO: <strong>99,97%</strong>",
      langLabel: "IDIOMA",
      sec1Title: "1) QUANTOS ERROS POSSO TER?",
      sec2Title: "2) QUANTOS JOGOS PRECISO COM ESSES ERROS?",
      sec3Title: "3) CALENDÁRIO DE TURNOS (INDEPENDENTE)",
      totalGamesLabel: "TOTAL DE JOGOS:",
      mistakesLabel: "ERROS:",
      btnByGames: "CALCULAR ERROS PERMITIDOS",
      btnByErrors: "CALCULAR JOGOS NECESSÁRIOS",
      shiftTypeLabel: "TURNO",
      startLabel: "INÍCIO",
      endLabel: "FIM",
      noteLabel: "NOTA",
      saveShiftBtn: "SALVAR",
      clearDayBtn: "LIMPAR DIA",
      presetsTitle: "TURNOS PADRÃO",
      savePresetsBtn: "SALVAR TURNOS",
      clearAllShifts: "LIMPAR TODOS",
      footerText: "FEITO PARA VOCÊ ❤️",
      selectDayDefault: "SELECIONE UM DIA NO CALENDÁRIO",
      selectDayWithNoShift: function(iso){ return "DIA: " + iso + " (SEM TURNO)"; },
      selectedDayWithShift: function(iso,label,time){
        var t = "DIA: " + iso + " - " + label;
        if (time) t += " (" + time + ")";
        return t;
      },
      notePrefix: "NOTA:",
      dayHeaders: ["S","T","Q","Q","S","S","D"],
      monthLocale: "pt-PT",
      errGames: "INSIRA UM NÚMERO VÁLIDO DE JOGOS.",
      errMistakes: "INSIRA UM NÚMERO VÁLIDO DE ERROS.",
      errSelectDay: "TOQUE EM UM DIA DO CALENDÁRIO PRIMEIRO.",
      errPresetSaved: "TURNOS PADRÃO SALVOS.",
      hideSettings: "⚙ ESCONDER",
      showSettings: "⚙ CONFIGURAÇÕES",
      clearGames: "LIMPAR",
      clearErrors: "LIMPAR",
      quickTitle: "ESCOLHA O TURNO PARA %DATE%",
      quickCancel: "CANCELAR",
      quickOff: "FOLGA",
      quickClearDay: "LIMPAR ESTE DIA",
      confirmClearAll: "Isso vai apagar TODOS os turnos. Tem certeza?",
      resultGamesHtml: function(games, maxErrors, sgc){
        return "<p>JOGOS: <strong>" + games + "</strong></p>"
          + "<p>ERROS MÁXIMOS PARA FICAR ~" + TARGET + "%: <strong>" + maxErrors + "</strong></p>"
          + "<p>SGC ESTIMADO COM ESSE NÚMERO DE ERROS: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSÃO: COM " + games + " JOGOS, VOCÊ NÃO DEVE PASSAR DE " + maxErrors + " ERROS.</p>";
      },
      resultErrorsZeroHtml: function(){
        return "<p>ERROS: <strong>0</strong></p>"
          + "<p>VOCÊ PODE JOGAR QUALQUER NÚMERO DE JOGOS E O SEU SGC SERÁ 100%.</p>";
      },
      resultErrorsHtml: function(errors, minGames, sgc){
        return "<p>ERROS: <strong>" + errors + "</strong></p>"
          + "<p>JOGOS MÍNIMOS PARA FICAR ~" + TARGET + "%: <strong>" + minGames + "</strong></p>"
          + "<p>SGC COM " + errors + " ERROS EM " + minGames + " JOGOS: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSÃO: COM " + errors + " ERROS, VOCÊ DEVE TER PELO MENOS " + minGames + " JOGOS.</p>";
      }
    },
    es: {
      appTitle: "CALCULADORA SGC",
      targetLine: "OBJETIVO: <strong>99,97%</strong>",
      langLabel: "IDIOMA",
      sec1Title: "1) ¿CUÁNTOS ERRORES PUEDO TENER?",
      sec2Title: "2) ¿CUÁNTOS JUEGOS NECESITO CON ESTOS ERRORES?",
      sec3Title: "3) CALENDARIO DE TURNOS (INDEPENDIENTE)",
      totalGamesLabel: "TOTAL DE JUEGOS:",
      mistakesLabel: "ERRORES:",
      btnByGames: "CALCULAR ERRORES PERMITIDOS",
      btnByErrors: "CALCULAR JUEGOS NECESARIOS",
      shiftTypeLabel: "TURNO",
      startLabel: "INICIO",
      endLabel: "FIN",
      noteLabel: "NOTA",
      saveShiftBtn: "GUARDAR",
      clearDayBtn: "LIMPIAR DÍA",
      presetsTitle: "TURNOS PREDEF.",
      savePresetsBtn: "GUARDAR TURNOS",
      clearAllShifts: "BORRAR TODOS",
      footerText: "HECHO PARA TI ❤️",
      selectDayDefault: "SELECCIONA UN DÍA EN EL CALENDARIO",
      selectDayWithNoShift: function(iso){ return "DÍA: " + iso + " (SIN TURNO)"; },
      selectedDayWithShift: function(iso,label,time){
        var t = "DÍA: " + iso + " - " + label;
        if (time) t += " (" + time + ")";
        return t;
      },
      notePrefix: "NOTA:",
      dayHeaders: ["L","M","X","J","V","S","D"],
      monthLocale: "es-ES",
      errGames: "INTRODUCE UN NÚMERO VÁLIDO DE JUEGOS.",
      errMistakes: "INTRODUCE UN NÚMERO VÁLIDO DE ERRORES.",
      errSelectDay: "TOCA PRIMERO UN DÍA DEL CALENDARIO.",
      errPresetSaved: "TURNOS GUARDADOS.",
      hideSettings: "⚙ OCULTAR",
      showSettings: "⚙ AJUSTES",
      clearGames: "LIMPIAR",
      clearErrors: "LIMPIAR",
      quickTitle: "ELIGE EL TURNO PARA %DATE%",
      quickCancel: "CANCELAR",
      quickOff: "LIBRE",
      quickClearDay: "LIMPIAR ESTE DÍA",
      confirmClearAll: "Esto eliminará TODOS los turnos. ¿Seguro?",
      resultGamesHtml: function(games, maxErrors, sgc){
        return "<p>JUEGOS: <strong>" + games + "</strong></p>"
          + "<p>ERRORES MÁXIMOS PARA MANTENER ~" + TARGET + "%: <strong>" + maxErrors + "</strong></p>"
          + "<p>SGC ESTIMADO CON ESE NÚMERO DE ERRORES: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSIÓN: CON " + games + " JUEGOS, NO DEBERÍAS PASAR DE " + maxErrors + " ERRORES.</p>";
      },
      resultErrorsZeroHtml: function(){
        return "<p>ERRORES: <strong>0</strong></p>"
          + "<p>PUEDES JUGAR CUALQUIER NÚMERO DE JUEGOS Y TU SGC SERÁ 100%.</p>";
      },
      resultErrorsHtml: function(errors, minGames, sgc){
        return "<p>ERRORES: <strong>" + errors + "</strong></p>"
          + "<p>JUEGOS MÍNIMOS PARA MANTENER ~" + TARGET + "%: <strong>" + minGames + "</strong></p>"
          + "<p>SGC CON " + errors + " ERRORES EN " + minGames + " JUEGOS: <strong>" + sgc.toFixed(3) + "%</strong></p>"
          + "<p class=\"ok\">CONCLUSIÓN: CON " + errors + " ERRORES, DEBERÍAS TENER AL MENOS " + minGames + " JUEGOS.</p>";
      }
    }
  };

  var currentLang = "en";

  /* ---------- FUNÇÕES PARA COLOR AUTOMÁTICO DO TEXTO ---------- */
  function getBrightness(hex) {
    if (!hex) return 0;
    hex = hex.replace("#", "");
    if (hex.length === 3) {
      hex = hex[0]+hex[0] + hex[1]+hex[1] + hex[2]+hex[2];
    }
    var r = parseInt(hex.substring(0,2), 16);
    var g = parseInt(hex.substring(2,4), 16);
    var b = parseInt(hex.substring(4,6), 16);
    return (r * 299 + g * 587 + b * 114) / 1000;
  }

  function getContrastColor(hex) {
    return getBrightness(hex) > 140 ? "#111827" : "#ffffff";
  }
  /* ---------------------------------------------------------------- */


  function defaultPresets() {
    return [
      { id: "P1", label: "mañana",  start: "08:00", end: "16:00", color: "#facc15" },
      { id: "P2", label: "tarde",   start: "16:00", end: "00:00", color: "#22c55e" },
      { id: "P3", label: "noche",   start: "23:00", end: "08:00", color: "#6366f1" },
      { id: "P4", label: "VACATION", start: "",      end: "",      color: "#f97316" }
    ];
  }

  function loadPresets() {
    var raw = localStorage.getItem(PRESET_STORAGE_KEY);
    if (!raw) return defaultPresets();
    try {
      var parsed = JSON.parse(raw) || [];
      // Garantir que pelo menos P1, P2, P3 existam
      if (!Array.isArray(parsed) || parsed.length < 3) return defaultPresets();

      // Verificar se já existe o preset VACATION (P4)
      var hasP4 = false;
      for (var i = 0; i < parsed.length; i++) {
        if (parsed[i].id === "P4") {
          hasP4 = true;
          break;
        }
      }
      if (!hasP4) {
        parsed.push({ id: "P4", label: "VACATION", start: "", end: "", color: "#f97316" });
      }
      return parsed;
    } catch(e) {
      return defaultPresets();
    }
  }

  function savePresets(p) {
    localStorage.setItem(PRESET_STORAGE_KEY, JSON.stringify(p));
  }

  function loadShifts() {
    var raw = localStorage.getItem(SHIFT_STORAGE_KEY);
    if (!raw) return {};
    try {
      return JSON.parse(raw) || {};
    } catch(e) {
      return {};
    }
  }

  function saveShifts(obj) {
    localStorage.setItem(SHIFT_STORAGE_KEY, JSON.stringify(obj));
  }

  function formatMonthYear(y,m) {
    var t = i18n[currentLang];
    var d = new Date(y,m,1);
    return d.toLocaleDateString(t.monthLocale, {month:"long",year:"numeric"}).toUpperCase();
  }

  function getISODate(y,m,d) {
    var mm = (m+1).toString().padStart(2,"0");
    var dd = d.toString().padStart(2,"0");
    return y + "-" + mm + "-" + dd;
  }

  function updateToggleSettingsLabel() {
    var t = i18n[currentLang];
    toggleSettingsBtn.textContent = settingsVisible ? t.hideSettings : t.showSettings;
  }

  function updateSelectedDateDisplay(presets) {
    var t = i18n[currentLang];
    if (!selectedDateISO) {
      selectedDateDisplay.textContent = t.selectDayDefault;
      selectedNoteDisplay.textContent = "";
      return;
    }
    var data = loadShifts();
    var s = data[selectedDateISO];
    if (!s) {
      selectedDateDisplay.textContent = t.selectDayWithNoShift(selectedDateISO);
      selectedNoteDisplay.textContent = "";
      shiftNoteInput.value = "";
      customStartInput.value = "";
      customEndInput.value = "";
      shiftTypeSelect.value = presets[0].id;
      customTimeRow.style.display = "none";
      return;
    }
    var timeText = "";
    if (s.start && s.end) timeText = s.start + " -> " + s.end;
    else if (s.start) timeText = s.start;
    else if (s.end) timeText = s.end;

    selectedDateDisplay.textContent = t.selectedDayWithShift(selectedDateISO, s.label, timeText);
    if (s.note && s.note.trim() !== "") {
      selectedNoteDisplay.textContent = t.notePrefix + " " + s.note;
    } else {
      selectedNoteDisplay.textContent = "";
    }
    shiftNoteInput.value = s.note || "";

    if (s.presetId) {
      var exists = null;
      for (var i=0;i<presets.length;i++) {
        if (presets[i].id === s.presetId) { exists = presets[i]; break; }
      }
      if (exists) {
        shiftTypeSelect.value = s.presetId;
        customTimeRow.style.display = "none";
        customStartInput.value = "";
        customEndInput.value = "";
        return;
      }
    }
    shiftTypeSelect.value = "CUSTOM";
    customTimeRow.style.display = "flex";
    customStartInput.value = s.start || "";
    customEndInput.value = s.end || "";
  }

  function renderShiftTypeOptions(presets) {
    shiftTypeSelect.innerHTML = "";
    for (var i=0;i<presets.length;i++) {
      var p = presets[i];
      var opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.label + " (" + (p.start || "--") + "-" + (p.end || "--") + ")";
      shiftTypeSelect.appendChild(opt);
    }
    var offOpt = document.createElement("option");
    offOpt.value = "OFF";
    offOpt.textContent = "OFF";
    shiftTypeSelect.appendChild(offOpt);

    var cOpt = document.createElement("option");
    cOpt.value = "CUSTOM";
    cOpt.textContent = "CUSTOM";
    shiftTypeSelect.appendChild(cOpt);
  }

  function renderPresetsForm(presets) {
    presetsForm.innerHTML = "";
    for (var i=0;i<presets.length;i++) {
      var p = presets[i];
      var row = document.createElement("div");
      row.className = "preset-row";

      row.innerHTML =
        "<input type='text' data-role='label' data-id='" + p.id + "' value='" + p.label + "'>" +
        "<input type='time' data-role='start' data-id='" + p.id + "' value='" + p.start + "'>" +
        "<input type='time' data-role='end' data-id='" + p.id + "' value='" + p.end + "'>" +
        "<input type='color' data-role='color' data-id='" + p.id + "' value='" + p.color + "'>";

      presetsForm.appendChild(row);
    }
    var info = document.createElement("div");
    info.className = "preset-label";
    info.textContent = "EDIT NAME / START / END / COLOR.";
    presetsForm.appendChild(info);
  }

  function renderCalendar(presets) {
    var t = i18n[currentLang];
    calendarGrid.innerHTML = "";

    var headers = t.dayHeaders;
    for (var h=0; h<headers.length; h++) {
      var hd = document.createElement("div");
      hd.className = "calendar-day-header";
      hd.textContent = headers[h];
      calendarGrid.appendChild(hd);
    }

    var shifts = loadShifts();
    var first = new Date(currentYear, currentMonth, 1);
    var startWeekday = (first.getDay() + 6) % 7; // monday 0
    var daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();

    for (var i=0;i<startWeekday;i++) {
      var empty = document.createElement("div");
      empty.className = "calendar-cell calendar-empty";
      calendarGrid.appendChild(empty);
    }

    for (var d=1; d<=daysInMonth; d++) {
      var cell = document.createElement("div");
      cell.className = "calendar-cell";
      var iso = getISODate(currentYear,currentMonth,d);

      if (iso === selectedDateISO) cell.classList.add("selected");

      var dn = document.createElement("div");
      dn.className = "calendar-day-number";
      dn.textContent = String(d);
      cell.appendChild(dn);

      var s = shifts[iso];
      if (s) {
        var tag = document.createElement("div");
        tag.className = "calendar-shift-tag";

        var bg = s.color || "#4b5563";
        tag.style.backgroundColor = bg;
        var textColor = getContrastColor(bg);
        tag.style.color = textColor;

        var lab = document.createElement("div");
        lab.className = "shift-tag-label";
        lab.textContent = s.label || "";
        tag.appendChild(lab);

        var timeTxt = "";
        if (s.start) timeTxt = s.start;
        else if (s.end) timeTxt = s.end;

        if (timeTxt) {
          var tt = document.createElement("div");
          tt.className = "shift-tag-time";
          tt.textContent = timeTxt;
          tag.appendChild(tt);
        }
        cell.appendChild(tag);
      }

      (function(isoCopy, cellRef){
        cellRef.addEventListener("click", function(){
          var rect = cellRef.getBoundingClientRect();
          handleDayClick(isoCopy, presets, rect);
        });
      })(iso, cell);

      calendarGrid.appendChild(cell);
    }

    calendarMonthLabel.textContent = formatMonthYear(currentYear,currentMonth);
  }

  function openQuickPicker(iso, presets, rect) {
    var t = i18n[currentLang];
    selectedDateISO = iso;

    quickPickerTitle.textContent = t.quickTitle.replace("%DATE%", iso);
    quickPickerButtons.innerHTML = "";

    var data = loadShifts();

    for (var i=0;i<presets.length;i++) {
      var p = presets[i];
      var btn = document.createElement("button");
      btn.className = "quick-picker-btn";

      var main = document.createElement("div");
      main.className = "qp-main";

      var l = document.createElement("div");
      l.className = "qp-label";
      l.textContent = p.label;
      main.appendChild(l);

      var time = document.createElement("div");
      time.className = "qp-time";
      var txt = "";
      if (p.start && p.end) txt = p.start + " - " + p.end;
      else if (p.start || p.end) txt = (p.start || p.end);
      time.textContent = txt;
      main.appendChild(time);

      var dot = document.createElement("span");
      dot.className = "qp-dot";
      dot.style.backgroundColor = p.color;

      btn.appendChild(main);
      btn.appendChild(dot);

      (function(pCopy){
        btn.addEventListener("click", function(){
          data[iso] = {
            label: pCopy.label,
            color: pCopy.color,
            start: pCopy.start,
            end: pCopy.end,
            note: "",
            presetId: pCopy.id
          };
          saveShifts(data);
          updateSelectedDateDisplay(presets);
          renderCalendar(presets);
          closeQuickPicker();
        });
      })(p);

      quickPickerButtons.appendChild(btn);
    }

    var offBtn = document.createElement("button");
    offBtn.className = "quick-picker-btn quick-picker-btn-off";
    var mainOff = document.createElement("div");
    mainOff.className = "qp-main";
    var lOff = document.createElement("div");
    lOff.className = "qp-label";
    lOff.textContent = t.quickOff;
    mainOff.appendChild(lOff);
    var timeOff = document.createElement("div");
    timeOff.className = "qp-time";
    timeOff.textContent = "";
    mainOff.appendChild(timeOff);
    var dotOff = document.createElement("span");
    dotOff.className = "qp-dot";
    offBtn.appendChild(mainOff);
    offBtn.appendChild(dotOff);
    offBtn.addEventListener("click", function(){
      data[iso] = {
        label: "OFF",
        color: "#6b7280",
        start: "",
        end: "",
        note: "",
        presetId: null
      };
      saveShifts(data);
      updateSelectedDateDisplay(presets);
      renderCalendar(presets);
      closeQuickPicker();
    });
    quickPickerButtons.appendChild(offBtn);

    var clearBtn = document.createElement("button");
    clearBtn.className = "quick-picker-btn quick-picker-btn-danger";
    var mainCl = document.createElement("div");
    mainCl.className = "qp-main";
    var lCl = document.createElement("div");
    lCl.className = "qp-label";
    lCl.textContent = t.quickClearDay;
    mainCl.appendChild(lCl);
    clearBtn.appendChild(mainCl);
    clearBtn.addEventListener("click", function(){
      if (data[iso]) {
        delete data[iso];
        saveShifts(data);
      }
      updateSelectedDateDisplay(presets);
      renderCalendar(presets);
      closeQuickPicker();
    });
    quickPickerButtons.appendChild(clearBtn);

    quickPicker.style.display = "block";

    var card = quickPickerInner;
    var cardHeight = card.offsetHeight || 160;
    var top;
    if (rect) {
      top = rect.bottom + 8;
    } else {
      top = window.innerHeight - cardHeight - 24;
    }

    if (top + cardHeight + 8 > window.innerHeight) {
      top = window.innerHeight - cardHeight - 16;
    }
    if (top < 16) top = 16;

    card.style.top = top + "px";
    card.style.left = "50%";
    card.style.transform = "translateX(-50%)";
  }

  function closeQuickPicker() {
    quickPicker.style.display = "none";
  }

  quickPickerCancel.addEventListener("click", closeQuickPicker);

  quickPicker.addEventListener("click", function(e){
    if (e.target === quickPicker) closeQuickPicker();
  });

  function handleDayClick(iso, presets, rect) {
    if (settingsVisible) {
      selectedDateISO = iso;
      updateSelectedDateDisplay(presets);
      renderCalendar(presets);
    } else {
      openQuickPicker(iso, presets, rect);
    }
  }

  prevMonthBtn.addEventListener("click", function(){
    var presets = loadPresets();
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
    renderCalendar(presets);
  });

  nextMonthBtn.addEventListener("click", function(){
    var presets = loadPresets();
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    renderCalendar(presets);
  });

  shiftTypeSelect.addEventListener("change", function(){
    var v = shiftTypeSelect.value;
    if (v === "CUSTOM") customTimeRow.style.display = "flex";
    else customTimeRow.style.display = "none";
  });

  saveShiftBtn.addEventListener("click", function(){
    var t = i18n[currentLang];
    if (!selectedDateISO) { alert(t.errSelectDay); return; }

    var presets = loadPresets();
    var typeKey = shiftTypeSelect.value;
    var note = shiftNoteInput.value;

    var label, color, start, end, presetId = null;

    if (typeKey === "CUSTOM") {
      label = "CUSTOM";
      color = "#0ea5e9";
      start = customStartInput.value;
      end = customEndInput.value;
    } else if (typeKey === "OFF") {
      label = "OFF";
      color = "#6b7280";
      start = "";
      end = "";
    } else {
      var p = null;
      for (var i=0;i<presets.length;i++) {
        if (presets[i].id === typeKey) { p = presets[i]; break; }
      }
      if (!p) return;
      label = p.label;
      color = p.color;
      start = p.start;
      end = p.end;
      presetId = p.id;
    }

    var data = loadShifts();
    data[selectedDateISO] = {
      label: label,
      color: color,
      start: start,
      end: end,
      note: note,
      presetId: presetId
    };
    saveShifts(data);
    updateSelectedDateDisplay(presets);
    renderCalendar(presets);
  });

  clearDayBtn.addEventListener("click", function(){
    var t = i18n[currentLang];
    if (!selectedDateISO) { alert(t.errSelectDay); return; }
    var data = loadShifts();
    if (data[selectedDateISO]) {
      delete data[selectedDateISO];
      saveShifts(data);
      var presets = loadPresets();
      updateSelectedDateDisplay(presets);
      renderCalendar(presets);
    }
  });

  clearAllBtn.addEventListener("click", function(){
    var t = i18n[currentLang];
    if (!confirm(t.confirmClearAll)) return;
    localStorage.removeItem(SHIFT_STORAGE_KEY);
    selectedDateISO = null;
    var presets = loadPresets();
    updateSelectedDateDisplay(presets);
    renderCalendar(presets);
  });

  savePresetsBtn.addEventListener("click", function(){
    var t = i18n[currentLang];
    var current = loadPresets();
    var updated = [];
    for (var i=0;i<current.length;i++) {
      updated.push({
        id: current[i].id,
        label: current[i].label,
        start: current[i].start,
        end: current[i].end,
        color: current[i].color
      });
    }
    var inputs = presetsForm.querySelectorAll("input");
    for (var j=0;j<inputs.length;j++) {
      var inp = inputs[j];
      var id = inp.getAttribute("data-id");
      var role = inp.getAttribute("data-role");
      for (var k=0;k<updated.length;k++) {
        if (updated[k].id === id) {
          if (role === "label") updated[k].label = inp.value;
          if (role === "start") updated[k].start = inp.value;
          if (role === "end") updated[k].end = inp.value;
          if (role === "color") updated[k].color = inp.value;
        }
      }
    }
    savePresets(updated);
    renderShiftTypeOptions(updated);
    var presets = loadPresets();
    updateSelectedDateDisplay(presets);
    renderCalendar(presets);
    alert(t.errPresetSaved);
  });

  toggleSettingsBtn.addEventListener("click", function(){
    settingsVisible = !settingsVisible;
    settingsPanel.style.display = settingsVisible ? "block" : "none";
    updateToggleSettingsLabel();
    if (settingsVisible) closeQuickPicker();
  });

  // SGC CALCULATORS
  btnByGames.addEventListener("click", function(){
    var t = i18n[currentLang];
    var games = parseInt(gamesInput.value,10);
    if (isNaN(games) || games <= 0) {
      resultByGames.style.display = "block";
      resultByGames.innerHTML = "<p style='color:red'>" + t.errGames + "</p>";
      return;
    }
    var maxErrors = Math.floor(RATE * games);
    var sgc = ( (games-maxErrors)/games )*100;
    resultByGames.style.display = "block";
    resultByGames.innerHTML = t.resultGamesHtml(games, maxErrors, sgc);
  });

  btnByErrors.addEventListener("click", function(){
    var t = i18n[currentLang];
    var errors = parseInt(errorsInput.value,10);
    if (isNaN(errors) || errors < 0) {
      resultByErrors.style.display = "block";
      resultByErrors.innerHTML = "<p style='color:red'>" + t.errMistakes + "</p>";
      return;
    }
    if (errors === 0) {
      resultByErrors.style.display = "block";
      resultByErrors.innerHTML = t.resultErrorsZeroHtml();
      return;
    }
    var minGames = Math.ceil(errors / RATE);
    var sgc = ( (minGames-errors)/minGames )*100;
    resultByErrors.style.display = "block";
    resultByErrors.innerHTML = t.resultErrorsHtml(errors, minGames, sgc);
  });

  clearGamesBtn.addEventListener("click", function(){
    gamesInput.value = "";
    resultByGames.innerHTML = "";
    resultByGames.style.display = "none";
  });

  clearErrorsBtn.addEventListener("click", function(){
    errorsInput.value = "";
    resultByErrors.innerHTML = "";
    resultByErrors.style.display = "none";
  });

  langSelect.addEventListener("change", function(){
    currentLang = langSelect.value;
    applyTranslations();

    // Atualizar também os resultados já visíveis quando trocar de idioma
    var t = i18n[currentLang];

    // Recalcular resultado da calculadora 1, se já houver
    var games = parseInt(gamesInput.value, 10);
    if (!isNaN(games) && games > 0 && resultByGames.style.display !== "none") {
      var maxErrors = Math.floor(RATE * games);
      var sgc1 = ((games - maxErrors) / games) * 100;
      if (typeof t.resultGamesHtml === "function") {
        resultByGames.innerHTML = t.resultGamesHtml(games, maxErrors, sgc1);
      }
    }

    // Recalcular resultado da calculadora 2, se já houver
    var errors = parseInt(errorsInput.value, 10);
    if (!isNaN(errors) && errors >= 0 && resultByErrors.style.display !== "none") {
      if (errors === 0 && typeof t.resultErrorsZeroHtml === "function") {
        resultByErrors.innerHTML = t.resultErrorsZeroHtml();
      } else if (typeof t.resultErrorsHtml === "function") {
        var minGames = Math.ceil(errors / RATE);
        var sgc2 = ((minGames - errors) / minGames) * 100;
        resultByErrors.innerHTML = t.resultErrorsHtml(errors, minGames, sgc2);
      }
    }
  });

  function applyTranslations() {
    var t = i18n[currentLang];
    document.getElementById("appTitle").textContent = t.appTitle;
    document.getElementById("targetLine").innerHTML = t.targetLine;
    document.getElementById("langLabel").textContent = t.langLabel;
    document.getElementById("sec1Title").textContent = t.sec1Title;
    document.getElementById("sec2Title").textContent = t.sec2Title;
    document.getElementById("sec3Title").textContent = t.sec3Title;
    document.getElementById("totalGamesLabel").textContent = t.totalGamesLabel;
    document.getElementById("mistakesLabel").textContent = t.mistakesLabel;
    btnByGames.textContent = t.btnByGames;
    btnByErrors.textContent = t.btnByErrors;
    clearGamesBtn.textContent = t.clearGames;
    clearErrorsBtn.textContent = t.clearErrors;
    document.getElementById("shiftTypeLabel").textContent = t.shiftTypeLabel;
    document.getElementById("startLabel").textContent = t.startLabel;
    document.getElementById("endLabel").textContent = t.endLabel;
    document.getElementById("noteLabel").textContent = t.noteLabel;
    saveShiftBtn.textContent = t.saveShiftBtn;
    clearDayBtn.textContent = t.clearDayBtn;
    document.getElementById("presetsTitle").textContent = t.presetsTitle;
    savePresetsBtn.textContent = t.savePresetsBtn;
    clearAllBtn.textContent = t.clearAllShifts;
    document.getElementById("footerText").textContent = t.footerText;
    quickPickerCancel.textContent = t.quickCancel;

    updateToggleSettingsLabel();
    var presets = loadPresets();
    updateSelectedDateDisplay(presets);
    renderCalendar(presets);
  }

  (function init() {
    var today = new Date();
    currentYear = today.getFullYear();
    currentMonth = today.getMonth();
    selectedDateISO = null;

    var presets = loadPresets();
    renderShiftTypeOptions(presets);
    renderPresetsForm(presets);
    renderCalendar(presets);

    settingsPanel.style.display = "none";
    applyTranslations();
  })();
</script>
</body>
</html>
